{"version":3,"sources":["../../../../src/routes/player/ctrls/fetchHistoryBet.js"],"names":["fetchHistoryBet","req","res","weekNum","body","find","user","_id","$gte","subtract","startOf","$lte","endOf","historyBetList","historyBets","weekSummary","add","format","bets","amount","isEmpty","map","historyBet","closedAt","resultAmount","json"],"mappings":"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","file":"fetchHistoryBet.js","sourcesContent":["import { HistoryBet } from '../../../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\n\nconst fetchHistoryBet = async (req, res) => {\n\n\tconst { weekNum } = req.body\n\tconst historyBetList = await HistoryBet.find({ 'owner.player': req.user._id, 'closedAt': {$gte: moment().subtract(weekNum, 'w').startOf('isoWeek'), $lte: moment().subtract(weekNum, 'w').endOf('isoWeek') } })\n\n\tlet historyBets = {\n\t\thistoryBetList: historyBetList,\n\t\tweekSummary: {\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(0, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(1, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(2, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(3, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(4, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(5, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(6, 'd').format('MMM DD')]: { bets: 0, amount: 0 }\n\t\t}\n\t}\n\n\n\tif(!_.isEmpty(historyBetList)){\n\t\thistoryBetList.map(historyBet => {\n\t\t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].amount += historyBet.resultAmount\n\t\t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].bets ++\n\t\t\treturn null\n\t\t})\n\t}\n\n\tres.json(historyBets)\n\n}\n\n\nexport default fetchHistoryBet\n\n"]}