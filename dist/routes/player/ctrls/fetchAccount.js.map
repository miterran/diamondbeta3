{"version":3,"sources":["../../../../src/routes/player/ctrls/fetchAccount.js"],"names":["fetchAccount","req","res","find","user","_id","playerOpenBets","$gte","startOf","$lte","endOf","playerHistoryBets","playerCreditPending","reduce","total","openBet","wagerDetail","riskAmount","playerCurrentBalance","historyBet","resultAmount","playerCurrentStatus","creditPending","currentBalance","availableCredit","Number","defaultSetting","weeklyStartCredit","findOneAndUpdate","currentStatus","totalWin","winAmount","totalRisk","straightBetCounter","orderType","parlayBetCounter","teaserBetCounter","reverseBetCounter","playerAccount","openBetStatus","straightBet","parlayBet","teaserBet","reverseBet","totalBets","length","thisWeekHistoryBetList","json"],"mappings":"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","file":"fetchAccount.js","sourcesContent":["import moment from 'moment';\nimport _ from 'lodash'\nimport Player from '../../../models/Player';\nimport { OpenBet, HistoryBet } from '../../../models/BetOrder';\nconst fetchAccount = async (req, res) => {\n\ttry{\n\n\t\tconst playerOpenBets = await OpenBet.find({ 'owner.player': req.user._id }, 'orderType wagerDetail.riskAmount wagerDetail.winAmount')\n\t\tconst playerHistoryBets = await HistoryBet.find({ 'owner.player': req.user._id, 'closedAt': {$gte: moment().startOf('isoWeek'), $lte: moment().endOf('isoWeek')} }, 'closedAt resultAmount')\n\t\tconst playerCreditPending = playerOpenBets.reduce((total, openBet) => total + openBet.wagerDetail.riskAmount, 0)\n\t\tconst playerCurrentBalance = playerHistoryBets.reduce((total, historyBet) => total + historyBet.resultAmount ,0)\n\n\t\tconst playerCurrentStatus = {\n\t\t\tcreditPending: playerCreditPending,\n\t\t\tcurrentBalance: playerCurrentBalance,\n\t\t\tavailableCredit: Number(req.user.defaultSetting.weeklyStartCredit) - Number(playerCreditPending) + Number(playerCurrentBalance)\n\t\t}\n\t\tawait Player.findOneAndUpdate({ _id: req.user._id }, {'$set': { currentStatus: playerCurrentStatus }})\n\n\t\tconst totalWin = playerOpenBets.reduce((total, openBet) => total + Number(openBet.wagerDetail.winAmount), 0)\n\t\tconst totalRisk = playerOpenBets.reduce((total, openBet) => total + Number(openBet.wagerDetail.riskAmount), 0)\n\t\tconst straightBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'Straight' ), 0)\n\t\tconst parlayBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'Parlay' ), 0)\n\t\tconst teaserBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'Teaser6040' || openBet.orderType === 'Teaser6545' || openBet.orderType === 'Teaser7050' || openBet.orderType === 'SuperTeaser' ), 0)  // indexOf\n\t\tconst reverseBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'ActionReverse' || openBet.orderType === 'WinReverse' ), 0)\n\n\t\tconst playerAccount = {\n\t\t\topenBetStatus: {\n\t\t\t\tstraightBet: straightBetCounter || 0,\n\t\t\t\tparlayBet: parlayBetCounter || 0,\n\t\t\t\tteaserBet: teaserBetCounter || 0,\n\t\t\t\treverseBet: reverseBetCounter || 0,\n\t\t\t\ttotalBets: playerOpenBets.length || 0,\n\t\t\t\ttotalRisk: totalRisk || 0,\n\t\t\t\ttotalWin: totalWin || 0\n\t\t\t},\n\t\t\tthisWeekHistoryBetList: playerHistoryBets\n\t\t}\n\n\t\tres.json(playerAccount)\n\n\t}catch(err){\n\t\tthrow err\n\t}\n}\n\nexport default fetchAccount;\n"]}