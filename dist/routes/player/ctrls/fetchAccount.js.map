{"version":3,"sources":["../../../../src/routes/player/ctrls/fetchAccount.js"],"names":["fetchAccount","req","res","find","user","_id","playerOpenBets","$gte","startOf","$lte","endOf","playerHistoryBets","playerCurrentBalance","reduce","total","historyBet","resultAmount","totalWin","openBet","wagerDetail","winAmount","straightBetCounter","orderType","parlayBetCounter","playerAccount","openBetStatus","straightBet","parlayBet","totalBets","length","totalRisk","currentStatus","creditPending","thisWeekSummary","add","format","bets","amount","isEmpty","map","closedAt","json"],"mappings":"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","file":"fetchAccount.js","sourcesContent":["import moment from 'moment';\nimport _ from 'lodash'\nimport Player from '../../../models/Player';\nimport { OpenBet, HistoryBet } from '../../../models/BetOrder';\nconst fetchAccount = async (req, res) => {\n\ttry{\n\n\t\tconst playerOpenBets = await OpenBet.find({ 'owner.player': req.user._id }, 'orderType wagerDetail.riskAmount wagerDetail.winAmount')\n\n\t\tconst playerHistoryBets = await HistoryBet.find({ 'owner.player': req.user._id, 'closedAt': {$gte: moment().startOf('isoWeek'), $lte: moment().endOf('isoWeek')} }, 'closedAt resultAmount')\n\n\t\tconst playerCurrentBalance = playerHistoryBets.reduce((total, historyBet) => total + historyBet.resultAmount ,0)\n\n\t\tconst totalWin = playerOpenBets.reduce((total, openBet) => total + openBet.wagerDetail.winAmount, 0)\n\n\t\tconst straightBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'Straight' ), 0)\n\n\t\tconst parlayBetCounter = playerOpenBets.reduce((total, openBet) => total + ( openBet.orderType === 'Parlay' ), 0)\n\n\t\tconst playerAccount = {\n\t\t\topenBetStatus: {\n\t\t\t\tstraightBet: straightBetCounter || 0,\n\t\t\t\tparlayBet: parlayBetCounter || 0,\n\t\t\t\ttotalBets: playerOpenBets.length || 0,\n\t\t\t\ttotalRisk: req.user.currentStatus.creditPending || 0,\n\t\t\t\ttotalWin: totalWin || 0\n\t\t\t},\n\t\t\tthisWeekSummary: {\n\t\t\t\t[moment().startOf('isoWeek').add(0, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(1, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(2, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(3, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(4, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(5, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t\t[moment().startOf('isoWeek').add(6, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t}\n\t\t}\n\n\t\tif(!_.isEmpty(playerHistoryBets)){\n\t\t\tplayerHistoryBets.map(historyBet => {\n\t\t\t\tplayerAccount.thisWeekSummary[moment(historyBet.closedAt).format('MMM DD')].amount += historyBet.resultAmount\n\t\t\t\tplayerAccount.thisWeekSummary[moment(historyBet.closedAt).format('MMM DD')].bets ++\n\t\t\t\treturn null\n\t\t\t})\n\t\t}\n\t\t\n\t\tres.json(playerAccount)\n\n\t}catch(err){\n\t\tthrow err\n\t}\n}\n\n\nexport default fetchAccount;"]}