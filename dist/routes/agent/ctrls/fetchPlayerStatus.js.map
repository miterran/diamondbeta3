{"version":3,"sources":["../../../../src/routes/agent/ctrls/fetchPlayerStatus.js"],"names":["fetchPlayerStatus","req","res","body","playerId","json","findOne","Types","ObjectId","player","find","$gte","startOf","$lte","endOf","thisWeekHistoryBetList","playerStatus","account","defaultSetting","currentStatus","openBetStatus","createdAt","lastOnline"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA;AAAA,sDAAoB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAGxB,UAAGD,IAAIE,IAAJ,CAASC,QAAT,KAAsB,EAAzB,EAA4B;AAC3BF,WAAIG,IAAJ,CAAS,EAAT;AACA;;AALuB;AAAA,aAOH,iBAAOC,OAAP,CAAe,EAAE,OAAO,mBAASC,KAAT,CAAeC,QAAf,CAAwBP,IAAIE,IAAJ,CAASC,QAAjC,CAAT,EAAf,EAAsE,mGAAtE,CAPG;;AAAA;AAOlBK,YAPkB;AAAA;AAAA,aAQa,qBAAWC,IAAX,CAAgB,EAAE,gBAAgB,mBAASH,KAAT,CAAeC,QAAf,CAAwBP,IAAIE,IAAJ,CAASC,QAAjC,CAAlB,EAA8D,YAAY,EAACO,MAAM,wBAASC,OAAT,CAAiB,SAAjB,CAAP,EAAoCC,MAAM,wBAASC,KAAT,CAAe,SAAf,CAA1C,EAA1E,EAAhB,EAAkK,uBAAlK,CARb;;AAAA;AAQlBC,4BARkB;AASlBC,kBATkB,GASH;AACpBC,gBAASR,OAAOQ,OADI;AAEpBC,uBAAgBT,OAAOS,cAFH;AAGpBC,sBAAeV,OAAOU,aAHF;AAIpBC,sBAAeX,OAAOW,aAJF;AAKpBL,+BAAwBA,sBALJ;AAMpBM,kBAAWZ,OAAOY,SANE;AAOpBC,mBAAYb,OAAOa;AAPC,OATG;;AAkBxBpB,UAAIG,IAAJ,CAASW,YAAT;AAlBwB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAApB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBAwBehB,iB","file":"fetchPlayerStatus.js","sourcesContent":["import Player from '../../../models/Player';\nimport { HistoryBet } from '../../../models/BetOrder';\nimport mongoose from 'mongoose';\nimport moment from 'moment';\n\nconst fetchPlayerStatus = async (req, res) => {\n\ttry{\n\n\t\tif(req.body.playerId === ''){\n\t\t\tres.json('')\n\t\t}\n\n\t\tconst player = await Player.findOne({ '_id': mongoose.Types.ObjectId(req.body.playerId) }, 'account.username account.activate defaultSetting currentStatus openBetStatus createdAt lastOnline')\n\t\tconst thisWeekHistoryBetList = await HistoryBet.find({ 'owner.player': mongoose.Types.ObjectId(req.body.playerId), 'closedAt': {$gte: moment().startOf('isoWeek'), $lte: moment().endOf('isoWeek')} }, 'closedAt resultAmount')\n\t\tconst playerStatus = {\n\t\t\taccount: player.account,\n\t\t\tdefaultSetting: player.defaultSetting,\n\t\t\tcurrentStatus: player.currentStatus,\n\t\t\topenBetStatus: player.openBetStatus,\n\t\t\tthisWeekHistoryBetList: thisWeekHistoryBetList,\n\t\t\tcreatedAt: player.createdAt,\n\t\t\tlastOnline: player.lastOnline\n\t\t}\n\t\tres.json(playerStatus)\n\t}catch(err){\n\t\tthrow err\n\t}\n}\n\nexport default fetchPlayerStatus;"]}