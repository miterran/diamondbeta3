{"version":3,"sources":["../../../../src/routes/agent/ctrls/fetchHistoryBet.js"],"names":["fetchHistoryBet","req","res","console","log","body","weekNum","find","user","_id","$gte","subtract","startOf","$lte","endOf","historyBetList","historyBets","weekSummary","add","format","bets","amount","isEmpty","forEach","historyBet","closedAt","Number","resultAmount","json"],"mappings":"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","file":"fetchHistoryBet.js","sourcesContent":["import { HistoryBet } from '../../../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\n\nconst fetchHistoryBet = async (req, res) => {\n\tconsole.log('hi')\n\tconsole.log(req.body)\n\tconst { weekNum } = req.body\n\tconst historyBetList = await HistoryBet.find({ 'owner.agent': req.user._id, 'closedAt': {$gte: moment().subtract(weekNum, 'w').startOf('isoWeek'), $lte: moment().subtract(weekNum, 'w').endOf('isoWeek') } })\n\n\tlet historyBets = {\n\t\thistoryBetList: historyBetList,\n\t\tweekSummary: {\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(0, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(1, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(2, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(3, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(4, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(5, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t\t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(6, 'd').format('MMM DD')]: { bets: 0, amount: 0 }\n\t\t}\n\t}\n\n\tif(!_.isEmpty(historyBetList)){\n\t\thistoryBetList.forEach(historyBet => {\n\t\t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].amount += Number(historyBet.resultAmount);\n\t\t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].bets++;\n\t\t})\n\t}\n\n\tres.json(historyBets)\n\n}\n\n\nexport default fetchHistoryBet\n\n"]}