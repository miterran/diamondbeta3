{"version":3,"sources":["../../../../src/routes/agent/ctrls/fetchHistoryBet.js"],"names":["fetchHistoryBet","req","res","weekNum","body","find","user","_id","$gte","subtract","startOf","$lte","endOf","populate","path","select","historyBetList","json"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA;AAAA,sDAAkB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACfC,aADe,GACHF,IAAIG,IADD,CACfD,OADe;AAAA;AAAA,aAEM,qBAAWE,IAAX,CAAgB;AAC5C,sBAAeJ,IAAIK,IAAJ,CAASC,GADoB;AAE5C,mBAAY,EAACC,MAAM,wBAASC,QAAT,CAAkBN,OAAlB,EAA2B,GAA3B,EAAgCO,OAAhC,CAAwC,SAAxC,CAAP,EAA2DC,MAAM,wBAASF,QAAT,CAAkBN,OAAlB,EAA2B,GAA3B,EAAgCS,KAAhC,CAAsC,SAAtC,CAAjE;AAFgC,OAAhB,EAG1BC,QAH0B,CAGjB;AACXC,aAAM,cADK;AAEXC,eAAQ;AAFG,OAHiB,CAFN;;AAAA;AAEjBC,oBAFiB;;;AAUvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAd,UAAIe,IAAJ,CAASD,cAAT;;AA9BuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAlB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBAmCehB,e","file":"fetchHistoryBet.js","sourcesContent":["import { HistoryBet } from '../../../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\n\nconst fetchHistoryBet = async (req, res) => {\n\tconst { weekNum } = req.body\n\tconst historyBetList = await HistoryBet.find({ \n\t\t'owner.agent': req.user._id, \n\t\t'closedAt': {$gte: moment().subtract(weekNum, 'w').startOf('isoWeek'), $lte: moment().subtract(weekNum, 'w').endOf('isoWeek') } \n\t}).populate({ \n\t\tpath: 'owner.player', \n\t\tselect: 'account.username'\n\t})\n\n\t// let historyBets = {\n\t// \thistoryBetList: historyBetList,\n\t// \tweekSummary: {\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(0, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(1, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(2, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(3, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(4, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(5, 'd').format('MMM DD')]: { bets: 0, amount: 0 },\n\t// \t\t[moment().startOf('isoWeek').subtract(weekNum, 'w').add(6, 'd').format('MMM DD')]: { bets: 0, amount: 0 }\n\t// \t}\n\t// }\n\n\t// if(!_.isEmpty(historyBetList)){\n\t// \thistoryBetList.forEach(historyBet => {\n\t// \t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].amount += Number(historyBet.resultAmount);\n\t// \t\thistoryBets.weekSummary[moment(historyBet.closedAt).format('MMM DD')].bets++;\n\t// \t})\n\t// }\n\n\tres.json(historyBetList)\n\n}\n\n\nexport default fetchHistoryBet\n\n"]}