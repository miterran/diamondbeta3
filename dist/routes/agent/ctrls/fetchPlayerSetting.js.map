{"version":3,"sources":["../../../../src/routes/agent/ctrls/fetchPlayerSetting.js"],"names":["fetchPlayerSetting","req","res","findOne","Types","ObjectId","body","playerId","player","find","$gte","startOf","$lte","endOf","thisWeekHistoryBetList","playerStatus","account","defaultSetting","currentStatus","openBetStatus","json"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA;AAAA,sDAAqB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAEJ,iBAAOC,OAAP,CAAe,EAAE,OAAO,mBAASC,KAAT,CAAeC,QAAf,CAAwBJ,IAAIK,IAAJ,CAASC,QAAjC,CAAT,EAAf,EAAsE,8EAAtE,CAFI;;AAAA;AAEnBC,YAFmB;AAAA;AAAA,aAGY,qBAAWC,IAAX,CAAgB,EAAE,gBAAgB,mBAASL,KAAT,CAAeC,QAAf,CAAwBJ,IAAIK,IAAJ,CAASC,QAAjC,CAAlB,EAA8D,YAAY,EAACG,MAAM,wBAASC,OAAT,CAAiB,SAAjB,CAAP,EAAoCC,MAAM,wBAASC,KAAT,CAAe,SAAf,CAA1C,EAA1E,EAAhB,EAAkK,uBAAlK,CAHZ;;AAAA;AAGnBC,4BAHmB;AAInBC,kBAJmB,GAIJ;AACpBC,gBAASR,OAAOQ,OADI;AAEpBC,uBAAgBT,OAAOS,cAFH;AAGpBC,sBAAeV,OAAOU,aAHF;AAIpBC,sBAAeX,OAAOW,aAJF;AAKpBL,+BAAwBA;AALJ,OAJI;;AAWzBZ,UAAIkB,IAAJ,CAASL,YAAT;AAXyB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAArB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBAiBef,kB","file":"fetchPlayerSetting.js","sourcesContent":["import Player from '../../../models/Player';\nimport { HistoryBet } from '../../../models/BetOrder';\nimport mongoose from 'mongoose';\nimport moment from 'moment';\n\nconst fetchPlayerSetting = async (req, res) => {\n\ttry{\n\t\tconst player = await Player.findOne({ '_id': mongoose.Types.ObjectId(req.body.playerId) }, 'account.username account.activate defaultSetting currentStatus openBetStatus')\n\t\tconst thisWeekHistoryBetList = await HistoryBet.find({ 'owner.player': mongoose.Types.ObjectId(req.body.playerId), 'closedAt': {$gte: moment().startOf('isoWeek'), $lte: moment().endOf('isoWeek')} }, 'closedAt resultAmount')\n\t\tconst playerStatus = {\n\t\t\taccount: player.account,\n\t\t\tdefaultSetting: player.defaultSetting,\n\t\t\tcurrentStatus: player.currentStatus,\n\t\t\topenBetStatus: player.openBetStatus,\n\t\t\tthisWeekHistoryBetList: thisWeekHistoryBetList\n\t\t}\n\t\tres.json(playerStatus)\n\t}catch(err){\n\t\tthrow err\n\t}\n}\n\nexport default fetchPlayerSetting;"]}