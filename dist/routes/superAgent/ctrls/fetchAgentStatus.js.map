{"version":3,"sources":["../../../../src/routes/superAgent/ctrls/fetchAgentStatus.js"],"names":["fetchAgentStatus","req","res","findOne","Types","ObjectId","body","agentId","populate","path","select","agent","find","$gte","startOf","$lte","endOf","agentHistoryBets","agentStatus","account","defaultSetting","currentStatus","openBetStatus","thisWeekHistoryBetList","createdAt","lastOnline","players","json"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;;;;;AACA,IAAMA;AAAA,sDAAmB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAEH,gBAAMC,OAAN,CAAc;AACjC,cAAO,mBAASC,KAAT,CAAeC,QAAf,CAAwBJ,IAAIK,IAAJ,CAASC,OAAjC;AAD0B,OAAd,EAEjB,iFAFiB,EAGnBC,QAHmB,CAGV;AACTC,aAAM,SADG;AAETC,eAAQ;AAFC,OAHU,CAFG;;AAAA;AAEjBC,WAFiB;AAAA;AAAA,aASQ,qBAAWC,IAAX,CAAgB,EAAE,eAAe,mBAASR,KAAT,CAAeC,QAAf,CAAwBJ,IAAIK,IAAJ,CAASC,OAAjC,CAAjB,EAA4D,YAAY,EAACM,MAAM,wBAASC,OAAT,CAAiB,SAAjB,CAAP,EAAoCC,MAAM,wBAASC,KAAT,CAAe,SAAf,CAA1C,EAAxE,EAAhB,EAAgK,uBAAhK,CATR;;AAAA;AASjBC,sBATiB;AAWjBC,iBAXiB;AAYtBC,gBAASR,MAAMQ,OAZO;AAatBC,uBAAgBT,MAAMS,cAbA;AActBC,sBAAeV,MAAMU,aAdC;AAetBC,sBAAeX,MAAMW,aAfC;AAgBtBC,+BAAwBN,gBAhBF;AAiBtBO,kBAAWb,MAAMa,SAjBK;AAkBtBC,mBAAYd,MAAMc;AAlBI,oDAmBXd,MAAMa,SAnBK,4CAoBbb,MAAMe,OApBO;;AAsBvBxB,UAAIyB,IAAJ,CAAST,WAAT;;AAtBuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAnB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBA0BelB,gB","file":"fetchAgentStatus.js","sourcesContent":["import mongoose from 'mongoose';\nimport moment from 'moment';\n\nimport Agent from '../../../models/Agent';\nimport { HistoryBet } from '../../../models/BetOrder'\nconst fetchAgentStatus = async (req, res) => {\n\n\t\tconst agent = await Agent.findOne({ \n\t\t\t'_id': mongoose.Types.ObjectId(req.body.agentId)\n\t\t}, 'account defaultSetting currentStatus openBetStatus players lastOnline createdAt')\n\t\t.populate({ \n\t\t\tpath: 'players', \n\t\t\tselect: 'account.username'\n\t\t})\n\t\tconst agentHistoryBets = await HistoryBet.find({ 'owner.agent': mongoose.Types.ObjectId(req.body.agentId), 'closedAt': {$gte: moment().startOf('isoWeek'), $lte: moment().endOf('isoWeek')} }, 'closedAt resultAmount')\n\n\t\tconst agentStatus = {\n\t\t\taccount: agent.account,\n\t\t\tdefaultSetting: agent.defaultSetting,\n\t\t\tcurrentStatus: agent.currentStatus,\n\t\t\topenBetStatus: agent.openBetStatus,\n\t\t\tthisWeekHistoryBetList: agentHistoryBets,\n\t\t\tcreatedAt: agent.createdAt,\n\t\t\tlastOnline: agent.lastOnline,\n\t\t\tcreatedAt: agent.createdAt,\n\t\t\tplayers: agent.players\n\t\t}\n\t\tres.json(agentStatus)\n\n} \n\nexport default fetchAgentStatus"]}