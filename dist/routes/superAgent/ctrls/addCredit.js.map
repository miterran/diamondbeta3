{"version":3,"sources":["../../../../src/routes/superAgent/ctrls/addCredit.js"],"names":["addCredit","req","res","body","creditAmount","agentUsername","findOneAndUpdate","new","agent","newAgentDeposit","owner","superAgent","user","_id","priceAmount","orderNumber","process","toUpperCase","save","newAgentTransaction","orderType","transactionType","resultAmount","currentStatus","credit","json"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA;AAAA,sDAAY,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAGwBD,IAAIE,IAH5B,EAGRC,YAHQ,aAGRA,YAHQ,EAGMC,aAHN,aAGMA,aAHN;AAAA;AAAA,aAKI,gBAAMC,gBAAN,CAAuB,EAAE,oBAAoBD,aAAtB,EAAvB,EAA8D,EAAE,QAAQ,EAAE,wBAAwBD,YAA1B,EAAwC,iCAAiCA,YAAzE,EAAV,EAA9D,EAAkK,EAAEG,KAAK,IAAP,EAAlK,CALJ;;AAAA;AAKVC,WALU;AAOZC,qBAPY,GAOM,2BAAiB;AACtCC,cAAM;AACLC,oBAAaV,IAAIW,IAAJ,CAASC,GADjB;AAELL,eAAQA,MAAMK;AAFT,QADgC;AAKtCT,qBAAcA,YALwB;AAMtCU,oBAAa,CANyB;AAOtCC,oBAAa,iBAAOC,OAAP,GAAiBC,WAAjB;AAPyB,OAAjB,CAPN;AAAA;AAAA,aAgBVR,gBAAgBS,IAAhB,EAhBU;;AAAA;AAkBZC,yBAlBY,GAkBU,+BAAqB;AAC9CT,cAAM;AACLC,oBAAaV,IAAIW,IAAJ,CAASC,GADjB;AAELL,eAAQA,MAAMK;AAFT,QADwC;AAK9CO,kBAAW,SALmC;AAM9CC,wBAAiB,IAN6B;AAO9CjB,qBAAcA,YAPgC;AAQ9CkB,qBAAcd,MAAMe,aAAN,CAAoBC,MARY;AAS9CT,oBAAaN,gBAAgBM;AATiB,OAArB,CAlBV;AAAA;AAAA,aA8BVI,oBAAoBD,IAApB,EA9BU;;AAAA;AA+BhBhB,UAAIuB,IAAJ,CAAS,MAAT;;AA/BgB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAZ;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBAsCezB,S","file":"addCredit.js","sourcesContent":["import _ from 'lodash';\nimport uniqid from 'uniqid';\nimport moment from 'moment';\n\nimport AgentDeposit from '../../../models/AgentDeposit';\nimport AgentTransaction from '../../../models/AgentTransaction';\nimport Agent from '../../../models/Agent';\n\nconst addCredit = async (req, res) => {\n\ttry{\n\n\t\tconst { creditAmount, agentUsername } = req.body\n\n\t\tconst agent = await Agent.findOneAndUpdate({ 'account.username': agentUsername }, { '$inc': { 'currentStatus.credit': creditAmount, 'currentStatus.availableCredit': creditAmount }}, { new: true })\n\n\t\tlet newAgentDeposit = new AgentDeposit({\n\t\t\towner:{\n\t\t\t\tsuperAgent : req.user._id,\n\t\t\t\tagent : agent._id\n\t\t\t},\n\t\t\tcreditAmount: creditAmount,\n\t\t\tpriceAmount: 0,\n\t\t\torderNumber: uniqid.process().toUpperCase()\n\t\t})\n\t\tawait newAgentDeposit.save()\n\n\t\tlet newAgentTransaction = new AgentTransaction({\n\t\t\towner:{\n\t\t\t\tsuperAgent : req.user._id,\n\t\t\t\tagent : agent._id,\n\t\t\t},\n\t\t\torderType: 'Deposit',\n\t\t\ttransactionType: 'in',\n\t\t\tcreditAmount: creditAmount,\n\t\t\tresultAmount: agent.currentStatus.credit,\n\t\t\torderNumber: newAgentDeposit.orderNumber\n\t\t})\n\n\t\tawait newAgentTransaction.save()\n\t\tres.json('done')\n\n\t}catch(err){\n\t\tthrow err\n\t}\n}\n\nexport default addCredit;\n\n\n"]}