{"version":3,"sources":["../../../src/updateDB/confirmOrderTypeResult/confirmResultReverse.js"],"names":["confirmResultReverse","openBet","allEventsReview","every","eventOdds","status","allEventsPending","eventsHaveReview","some","eventsHavePending","betOrderStatus","resultAmount","teamLength","range","length","inOrder","orderList","betAmount","wagerDetail","Number","forEach","list","idx","betDetail","winAmount","oddLine","Math","round","abs","orderType","newHistoryBet","orderNumber","owner","toFixed","createdAt","closedAt","save","console","log","findOneAndRemove","_id"],"mappings":"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","file":"confirmResultReverse.js","sourcesContent":["import { OpenBet, HistoryBet } from '../../models/BetOrder';\nimport moment from 'moment'\nimport permutation from '../../utils/permutation'\nimport multiDimensionalUnique from '../../utils/multiDimensionalUnique'\nimport _ from 'lodash'\n\n\nconst confirmResultReverse = async (openBet) => {\n\n\tconst allEventsReview     = _.every(openBet.eventOdds, { status: 'Review' })\n\tconst allEventsPending    = _.every(openBet.eventOdds, { status: 'Pending' })\n\tconst eventsHaveReview    = _.some(openBet.eventOdds, { status: 'Review' })\n\tconst eventsHavePending   = _.some(openBet.eventOdds, { status: 'Pending' })\n\n\n\tlet betOrderStatus = 'TBD'\n\tlet resultAmount = 0\n\n\tconst teamLength = _.range(openBet.eventOdds.length)\n\tconst inOrder = permutation(teamLength)\n\tconst orderList = multiDimensionalUnique(inOrder)\n\tlet { betAmount } = openBet.wagerDetail\n\tbetAmount = Number(betAmount)\n\n\tif(!eventsHaveReview && !allEventsReview && !allEventsPending && !eventsHavePending){\n\t\n\n\t\torderList.forEach(list => {\n\t\t\tfor(let idx of list){\n\t\t\t\tconst { status, betDetail } = openBet.eventOdds[idx]\n\t\t\t\tswitch(status){\n\t\t\t \t\tcase 'Won':\n\t\t\t \t\t\tlet winAmount = 0\n\t\t\t \t\t\tif(Number(betDetail.oddLine) > 0){\n\t\t\t \t\t\t\twinAmount = Math.round(betAmount * Number(betDetail.oddLine) / 100)\n\t\t\t \t\t\t}else{\n\t\t\t \t\t\t\twinAmount = Math.round(betAmount / Math.abs(Number(betDetail.oddLine)) * 100)\n\t\t\t \t\t\t}\n\t\t\t \t\t\tresultAmount += winAmount\n\t\t\t \t\t\tbreak;\n\t\t\t \t\tcase 'Lost':\n\t\t\t \t\t\tresultAmount -= betAmount\n\t\t\t \t\t\treturn\n\t\t\t \t\tcase 'Push':\n\t\t\t \t\tcase 'Canceled':\n\t\t\t \t\tcase 'Postponed':\n\t\t\t \t\t\tif(openBet.orderType === 'ActionReverse'){\n\t\t\t \t\t\t\tbreak;\n\t\t\t \t\t\t}\n\t\t\t \t\t\tif(openBet.orderType === 'WinReverse'){\n\t\t\t \t\t\t\treturn;\n\t\t\t \t\t\t}\n\t\t\t \t\tdefault:\n\t\t\t \t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\n\n\t\tif(resultAmount === 0){\n\t\t\tbetOrderStatus = 'Push'\n\t\t}\n\n\t\tif(resultAmount > 0){\n\t\t\tbetOrderStatus = 'Won'\n\t\t}\n\n\t\tif(resultAmount < 0){\n\t\t\tbetOrderStatus = 'Lost'\n\t\t}\n\n\t}\n\n\n\n\n\n\tif(betOrderStatus !== 'TBD'){\n\t\tconst newHistoryBet = new HistoryBet({\n\t\t\torderNumber: openBet.orderNumber,\n\t\t\torderType: openBet.orderType,\n\t\t\towner: openBet.owner,\n\t\t\twagerDetail: openBet.wagerDetail,\n\t\t\tstatus: betOrderStatus,\n\t\t\tresultAmount: resultAmount.toFixed(),\n\t\t\teventOdds: openBet.eventOdds,\n\t\t\tcreatedAt: openBet.createdAt,\n\t\t\tclosedAt: moment()\n\t\t})\n\t\n\t\tawait newHistoryBet.save()\n\t\tconsole.log('saved history straight bet' + newHistoryBet.orderNumber)\n\t\tawait OpenBet.findOneAndRemove({ _id: openBet._id })\n\t\tconsole.log('deleted openbet ' + openBet.orderNumber)\n\t\treturn true\n\n\t}\n\n}\n\nexport default confirmResultReverse\n\n\n\n// export const handleReverseChangeRiskAmount = (e) => {\n// \treturn (dispatch, getState) => {\n\n// \t\tconst { orderType } = getState().playerUtilsReducer\n// \t\tconst reverseEvents = getState().playerOddWagerReducer.oddWagerPickList\n// //\t\tconst betAmount = Number(e.target.value) * reverseEvents.length\n\n// \t\tconst reverseOddLine = reverseEvents.map(event => {\n// \t\t\tif(event.betDetail.oddLine > 0){\n// \t\t\t\treturn Math.round(Number(e.target.value) * event.betDetail.oddLine / 100)\n// \t\t\t}else{\n// \t\t\t\treturn Math.round(Number(e.target.value) / Math.abs(event.betDetail.oddLine) * 100)\n// \t\t\t}\n// \t\t})\n\n// \t\tconst singleRisk = reverseOddLine.reduce((total, value) => total += value)\n// \t\tconst riskAmount = ( reverseEvents.length - 1 ) * reverseEvents.length * Number(e.target.value)\n// \t\tconst winAmount = ( reverseEvents.length - 1 ) * 2 * singleRisk\n\t\t\n\n// \t\tconst wagerDetail = {\n// \t\t\tbetType: 'risk',\n// \t\t\tbetAmount: Number(e.target.value).toFixed(),\n// \t\t\triskAmount: Number(riskAmount).toFixed(),\n// \t\t\twinAmount: Number(winAmount).toFixed(),\n// \t\t\tconfirm: false\n// \t\t}\n// \t\treturn dispatch({\n// \t\t\ttype: 'HANDLE_REVERSE_CHANGE_RISK_AMOUNT', payload: wagerDetail\n// \t\t})\n// \t}\n// }"]}