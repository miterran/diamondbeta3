{"version":3,"sources":["../../../src/updateDB/confirmOrderTypeResult/confirmResultParlay.js"],"names":["confirmResultParlay","openBet","betOrderStatus","resultAmount","eventsHaveWon","some","eventOdds","status","eventsHaveLost","eventsHavePush","eventsHavePostponed","eventsHaveCanceled","eventsHaveReview","eventsHavePending","allEventsWon","every","allEventsLost","allEventsPush","allEventsCanceled","allEventsPostponed","allEventsReview","allEventsPending","wagerDetail","winAmount","riskAmount","Number","map","event","parlayPoint","compact","oddLine","betDetail","Math","abs","riskPoint","reduce","a","b","toFixed","console","log","orderNumber","newHistoryBet","orderType","owner","createdAt","closedAt","save","findOneAndRemove","_id"],"mappings":"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","file":"confirmResultParlay.js","sourcesContent":["import { OpenBet, HistoryBet } from '../../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\nconst confirmResultParlay = async (openBet) => {\n\n\tlet betOrderStatus = 'TBD'\n\tlet resultAmount = 0\n\n\tconst eventsHaveWon       = _.some(openBet.eventOdds, { status: 'Won' })\n\tconst eventsHaveLost      = _.some(openBet.eventOdds, { status: 'Lost' })\n\tconst eventsHavePush      = _.some(openBet.eventOdds, { status: 'Push' })\n\tconst eventsHavePostponed = _.some(openBet.eventOdds, { status: 'Postponed' })\n\tconst eventsHaveCanceled  = _.some(openBet.eventOdds, { status: 'Canceled' })\n\tconst eventsHaveReview    = _.some(openBet.eventOdds, { status: 'Review' })\n\tconst eventsHavePending   = _.some(openBet.eventOdds, { status: 'Pending' })\n\t\n\tconst allEventsWon        = _.every(openBet.eventOdds, { status: 'Won' })\n\tconst allEventsLost       = _.every(openBet.eventOdds, { status: 'Lost' })\n\tconst allEventsPush       = _.every(openBet.eventOdds, { status: 'Push' })\n\tconst allEventsCanceled   = _.every(openBet.eventOdds, { status: 'Postponed' })\n\tconst allEventsPostponed  = _.every(openBet.eventOdds, { status: 'Canceled' })\n\tconst allEventsReview     = _.every(openBet.eventOdds, { status: 'Review' })\n\tconst allEventsPending    = _.every(openBet.eventOdds, { status: 'Pending' })\n\n\t//case !eventsHaveWon && !eventsHaveLost && !eventsHavePush && !eventsHavePending && ( eventsHavePostponed || eventsHaveCanceled ):\n\n\tlet { winAmount, riskAmount } = openBet.wagerDetail\n\twinAmount = Number(winAmount)\n\triskAmount = Number(riskAmount)\n\n\tswitch(true){\n\t\tcase allEventsWon:\n\t\t\tbetOrderStatus = 'Won'\n\t\t\tresultAmount = winAmount\n\t\t\tbreak;\n\t\tcase allEventsLost:\n\t\t\tbetOrderStatus = 'Lost'\n\t\t\tresultAmount = -riskAmount\n\t\t\tbreak;\n\t\tcase allEventsPush:\n\t\t\tbetOrderStatus = 'Push'\n\t\t\tresultAmount = 0\n\t\t\tbreak;\n\t\tcase !eventsHaveWon && !eventsHaveLost && !eventsHavePush && !eventsHavePending && ( eventsHavePostponed || eventsHaveCanceled ):\n\t\tcase allEventsPostponed:\n\t\tcase allEventsCanceled:\n\t\t\tbetOrderStatus = 'Canceled'\n\t\t\tresultAmount = 0\n\t\t\tbreak;\n\t\tcase eventsHaveLost:\n\t\t\tbetOrderStatus = 'Lost'\n\t\t\tresultAmount = -riskAmount\n\t\t\topenBet.eventOdds.map(event => {\n\t\t\t\tif(event.status !== 'Lost'){\n\t\t\t\t\tevent.status = 'Closed'\n\t\t\t\t}\n\t\t\t\treturn event\n\t\t\t})\n\t\t\tbreak;\n\t\tcase eventsHaveWon && !eventsHaveLost && !eventsHaveReview && !eventsHavePending:\n\t\t\tconst parlayPoint = _.compact(openBet.eventOdds.map(event => {\n\t\t\t\tlet { oddLine } = event.betDetail\n\t\t\t\toddLine = Number(oddLine)\n\t\t\t\tif(event.status === 'Won'){\n\t\t\t\t\tif(oddLine > 0){\n\t\t\t\t\t\treturn (oddLine + 100) / 100\n\t\t\t\t\t}else{\n\t\t\t\t\t\treturn (Math.abs(oddLine) + 100) / Math.abs(oddLine)\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t}))\n\t\t\tconst riskPoint = parlayPoint.reduce((a, b) => Number(a) * Number(b))\n\t\t\tresultAmount = ((riskAmount * riskPoint - riskAmount) * 1).toFixed()\n\t\t\tbetOrderStatus = 'Won'\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(openBet.orderNumber + ' parlay not finished')\n\t\t\treturn false;\n\t}\n\n\tif(betOrderStatus !== 'TBD'){\n\t\tconst newHistoryBet = new HistoryBet({\n\t\t\torderNumber: openBet.orderNumber,\n\t\t\torderType: openBet.orderType,\n\t\t\towner: openBet.owner,\n\t\t\twagerDetail: openBet.wagerDetail,\n\t\t\tstatus: betOrderStatus,\n\t\t\tresultAmount: resultAmount,\n\t\t\teventOdds: openBet.eventOdds,\n\t\t\tcreatedAt: openBet.createdAt,\n\t\t\tclosedAt: moment()\n\t\t})\n\t\n\t\tawait newHistoryBet.save()\n\t\tconsole.log('saved history straight bet' + newHistoryBet.orderNumber)\n\t\tawait OpenBet.findOneAndRemove({ _id: openBet._id })\n\t\tconsole.log('deleted openbet ' + openBet.orderNumber)\n\t\treturn true\n\n\t}\n\n}\n\nexport default confirmResultParlay"]}