{"version":3,"sources":["../../../src/updateDB/confirmOrderTypeResult/confirmResultStraight.js"],"names":["confirmResultStraight","openBet","betOrderStatus","resultAmount","eventOdds","status","Number","wagerDetail","winAmount","riskAmount","toFixed","console","log","orderNumber"],"mappings":";;;;;;AAAA;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;AAGA,IAAMA;AAAA,sDAAwB,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAEzBC,oBAFyB,GAER,KAFQ;AAGzBC,kBAHyB,GAGV,CAHU;AAAA,oBAMtBF,QAAQG,SAAR,CAAkB,CAAlB,EAAqBC,MANC;AAAA,sCAOvB,KAPuB,uBAWvB,MAXuB,uBAevB,UAfuB,wBAmBvB,WAnBuB,wBAuBvB,MAvBuB,wBA2BvB,WA3BuB,wBA4BvB,UA5BuB;AAAA;;AAAA;AAQ3BH,uBAAiB,KAAjB;AACAC,qBAAeG,OAAOL,QAAQM,WAAR,CAAoBC,SAA3B,CAAf;AAT2B;;AAAA;AAY3BN,uBAAiB,MAAjB;AACAC,qBAAe,CAACG,OAAOL,QAAQM,WAAR,CAAoBE,UAA3B,CAAhB;AAb2B;;AAAA;AAgB3BP,uBAAiB,KAAjB;AACAC,qBAAe,CAAEG,OAAOL,QAAQM,WAAR,CAAoBC,SAA3B,IAAwC,CAA1C,EAA8CE,OAA9C,EAAf;AAjB2B;;AAAA;AAoB3BR,uBAAiB,MAAjB;AACAC,qBAAe,CAAC,CAAEG,OAAOL,QAAQM,WAAR,CAAoBE,UAA3B,IAAyC,CAA3C,EAA+CC,OAA/C,EAAhB;AArB2B;;AAAA;AAwB3BR,uBAAiB,MAAjB;AACAC,qBAAe,CAAf;AAzB2B;;AAAA;AA6B3BD,uBAAiB,UAAjB;AACAC,qBAAe,CAAf;AA9B2B;;AAAA;AAiC3BQ,cAAQC,GAAR,CAAYX,QAAQY,WAAR,GAAsB,wBAAlC;AAjC2B,uCAkCpB,KAlCoB;;AAAA;AAAA,YAsC1BX,mBAAmB,KAtCO;AAAA;AAAA;AAAA;;AAAA;AAAA,aAwCtB,iCAAkBD,OAAlB,EAA2BC,cAA3B,EAA2CC,YAA3C,CAxCsB;;AAAA;AAAA,uCAkFrB,IAlFqB;;AAAA;AAAA,uCAqFrB,KArFqB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAxB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBA4FeH,qB","file":"confirmResultStraight.js","sourcesContent":["import { OpenBet, HistoryBet } from '../../models/BetOrder';\nimport moment from 'moment'\n\nimport Agent from '../../models/Agent';\nimport AgentTransaction from '../../models/AgentTransaction';\nimport saveNewHistoryBet from './utils/saveNewHistoryBet'\n\n\nconst confirmResultStraight = async (openBet) => {\n\n\tlet betOrderStatus = 'TBD'\n\tlet resultAmount = 0\n\n\n\tswitch(openBet.eventOdds[0].status){\n\t\tcase 'Won':\n\t\t\tbetOrderStatus = 'Won'\n\t\t\tresultAmount = Number(openBet.wagerDetail.winAmount)\n\t\t\tbreak;\n\t\tcase 'Lost':\n\t\t\tbetOrderStatus = 'Lost'\n\t\t\tresultAmount = -Number(openBet.wagerDetail.riskAmount)\n\t\t\tbreak;\n\t\tcase 'Won Half':\n\t\t\tbetOrderStatus = 'Won'\n\t\t\tresultAmount = ( Number(openBet.wagerDetail.winAmount) / 2 ).toFixed()\n\t\t\tbreak;\n\t\tcase 'Lost Half':\n\t\t\tbetOrderStatus = 'Lost'\n\t\t\tresultAmount = -( Number(openBet.wagerDetail.riskAmount) / 2 ).toFixed()\n\t\t\tbreak;\n\t\tcase 'Push':\n\t\t\tbetOrderStatus = 'Push'\n\t\t\tresultAmount = 0\n\t\t\tbreak;\n\t\tcase 'Postponed':\n\t\tcase 'Canceled':\n\t\t\tbetOrderStatus = 'Canceled'\n\t\t\tresultAmount = 0\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(openBet.orderNumber + ' straight not finished')\n\t\t\treturn false;\n\t}\n\n\n\tif(betOrderStatus !== 'TBD'){\n\n\t\tawait saveNewHistoryBet(openBet, betOrderStatus, resultAmount)\n\t\t\n\t\t// const newHistoryBet = new HistoryBet({\n\t\t// \torderNumber: openBet.orderNumber,\n\t\t// \torderType: openBet.orderType,\n\t\t// \towner: openBet.owner,\n\t\t// \twagerDetail: openBet.wagerDetail,\n\t\t// \tstatus: betOrderStatus,\n\t\t// \tresultAmount: resultAmount,\n\t\t// \teventOdds: openBet.eventOdds,\n\t\t// \tcreatedAt: openBet.createdAt,\n\t\t// \tclosedAt: moment()\n\t\t// })\n\t\n\t\t// await newHistoryBet.save()\n\t\t// console.log('saved history straight bet' + newHistoryBet.orderNumber)\n\t\t// await OpenBet.findOneAndRemove({ _id: openBet._id })\n\t\t// console.log('deleted openbet ' + openBet.orderNumber)\n\n\n\t\t// if(betOrderStatus.status === 'Lost'){\n\t\t// \tconst agent = await Agent.findOneAndUpdate({ _id: req.user.agent }, { '$inc': { 'currentStatus.credit': resultAmount, 'currentStatus.availableCredit': resultAmount } })\n\t\t// \tlet newAgentTransaction = new AgentTransaction({\n\t\t// \t\towner:{\n\t\t// \t\t\tplayer: req.user._id,\n\t\t// \t\t\tsuperAgent : req.user.superAgent,\n\t\t// \t\t\tagent : req.user.agent\n\t\t// \t\t},\n\t\t// \t\torderType: openBet.orderType,\n\t\t// \t\ttransactionType: 'out',\n\t\t// \t\tcreditAmount: resultAmount,\n\t\t// \t\tresultAmount: agent.currentStatus.credit + resultAmount,\n\t\t// \t\torderNumber: openBet.orderNumber,\n\t\t// \t\tcreatedAt: moment()\n\t\t// \t})\n\t\t// \tawait newAgentTransaction.save()\n\t\t// }\n\n\n\n\n\n\t\treturn true\n\n\t}else{\n\t\treturn false\n\t}\n\n\n\n}\n\nexport default confirmResultStraight"]}