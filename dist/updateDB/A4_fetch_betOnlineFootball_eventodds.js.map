{"version":3,"sources":["../../src/updateDB/A4_fetch_betOnlineFootball_eventodds.js"],"names":["fetch_betOnlineFootball_eventOdds","findOne","provider","activate","betOnlineNBA","get","apiLink","response","isEmpty","data","explicitArray","nbaData","bestlinesports_line_feed","event","Promise","all","map","league","away","home","participant","visiting_home_draw","oddType","period","period_description","console","log","line","perioddesc","newEventOdd","uniqueId","rotnum","replace","toUpperCase","utc","event_datetimeGMT","add","subtract","format","source","bookmaker","id","lastUpdated","sport","region","details","matchTime","cutOffTime","periodcutoff_datetimeGMT","team","participant_name","homeROT","homePitcher","awayROT","awayPitcher","odds","moneyLineHome","Number","moneyline","moneyLineAway","pointSpreadHome","spread","spread_home","pointSpreadAway","spread_visiting","pointSpreadHomeLine","spread_adjust_home","pointSpreadAwayLine","spread_adjust_visiting","totalNumber","total","total_points","overLine","over_adjust","underLine","under_adjust","updatedAt","expireAt","existedEventOdd","save","findOneAndUpdate","$set"],"mappings":"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","file":"A4_fetch_betOnlineFootball_eventodds.js","sourcesContent":["import config from '../config'\nimport Provider from '../models/Provider';\nimport { EventOdd, Result } from '../models/EventOdd';\nimport { OpenBet } from '../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\nimport axios from 'axios'\nimport xml2js from'xml2js-es6-promise'\n\nconst fetch_betOnlineFootball_eventOdds = async () => {\n \ttry{\n \t\tconst betOnlineNBA = await Provider.findOne({ provider: 'betonlinefootball', activate: true })\n\n \t\tif(betOnlineNBA){\n\t\t \tconst response = await axios.get(betOnlineNBA.apiLink)\n\t\t \tif(!_.isEmpty(response.data)){\n\t\t \t\tconst nbaData = await xml2js(response.data, {explicitArray: false})\n\n\t\t \t\tif(!_.isEmpty(nbaData.bestlinesports_line_feed.event)){\n\t\t \t\t\tawait Promise.all(nbaData.bestlinesports_line_feed.event.map( async event => {\n\n\t\t\t\t\t\tif(event.league === 'NCAA Football' || event.league === 'NFL Football'){\n\n\t\t\t\t\t\t\tlet league = ''\n\t\t\t\t\t\t\tevent.league === 'NCAA Football' ? league = 'NCAA' : league = 'NFL'\n\n\t\t\t\t\t\t\tlet away = {}\n\t\t\t\t\t\t\tlet home = {}\n\t\t\t\t\t\t\tif(event.participant[0].visiting_home_draw === 'Visiting'){\n\t\t\t\t\t\t\t\taway = event.participant[0]\n\t\t\t\t\t\t\t\thome = event.participant[1]\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\taway = event.participant[1]\n\t\t\t\t\t\t\t\thome = event.participant[0]\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet oddType = ''\n\t\t\t\t\t\t\tswitch(event.period.period_description){\n\t\t\t\t\t\t\t\tcase 'Game':\n\t\t\t\t\t\t\t\t\toddType = 'Game';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '1st Half':\n\t\t\t\t\t\t\t\t\toddType = 'First Half';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '2nd Half':\n\t\t\t\t\t\t\t\t\toddType = 'Second Half';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '1st Quarter':\n\t\t\t\t\t\t\t\t\toddType = 'First Quarter';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '2nd Quarter':\n\t\t\t\t\t\t\t\t\toddType = 'Second Quarter';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '3rd Quarter':\n\t\t\t\t\t\t\t\t\toddType = 'Third Quarter';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '3rd Quarter':\n\t\t\t\t\t\t\t\t\toddType = 'Third Quarter';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '4th Quarter':\n\t\t\t\t\t\t\t\t\toddType = 'Fourth Quarter';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tconsole.log('new event !!!!!!!!!!!!!!!! ' + event.line.perioddesc)\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet newEventOdd = {\n\t\t\t\t\t\t\t\tuniqueId: `${home.rotnum}_${away.rotnum}_${`FOOTBALL`}_${oddType.replace(/\\s/g,'').toUpperCase()}_${moment.utc(event.event_datetimeGMT).add(4, 'h').subtract(0, 'm').format('MMDDYYYY')}`,\n\t\t\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\t\t\tprovider: 'betonline',\n\t\t\t\t\t\t\t\t\tbookmaker: 'betonline',\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tlastUpdated: moment()\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsport: 'Football',\n\t\t\t\t\t\t\t\toddType: oddType,\n\t\t\t\t\t\t\t\tleague: league,\n\t\t\t\t\t\t\t\tregion: '',\n\t\t\t\t\t\t\t\tdetails: '',\n\t\t\t\t\t\t\t\tmatchTime: moment.utc(event.event_datetimeGMT).add(4, 'h').subtract(0, 'm'),\n\t\t\t\t\t\t\t\tcutOffTime: moment.utc(event.period.periodcutoff_datetimeGMT).add(4, 'h').subtract(5, 'm').subtract(1, 'seconds'),\n\t\t\t\t\t\t\t\tteam: {\n\t\t\t\t\t\t\t\t\thome: home.participant_name,\n\t\t\t\t\t\t\t\t\thomeROT: home.rotnum,\n\t\t\t\t\t\t\t\t\thomePitcher: '',\n\t\t\t\t\t\t\t\t\taway: away.participant_name,\n\t\t\t\t\t\t\t\t\tawayROT: away.rotnum,\n\t\t\t\t\t\t\t\t\tawayPitcher:  '',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\todds: {\n\t\t\t\t\t\t\t\t\tmoneyLineHome: Number(home.odds.moneyline),\n\t\t\t\t\t\t\t\t\tmoneyLineAway: Number(away.odds.moneyline),\n\t\t\t\t\t\t\t\t\tpointSpreadHome: Number(event.period.spread.spread_home),\n\t\t\t\t\t\t\t\t\tpointSpreadAway: Number(event.period.spread.spread_visiting),\n\t\t\t\t\t\t\t\t\tpointSpreadHomeLine: Number(event.period.spread.spread_adjust_home),\n\t\t\t\t\t\t\t\t\tpointSpreadAwayLine: Number(event.period.spread.spread_adjust_visiting),\n\t\t\t\t\t\t\t\t\ttotalNumber: Number(event.period.total.total_points),\n\t\t\t\t\t\t\t\t\toverLine: Number(event.period.total.over_adjust),\n\t\t\t\t\t\t\t\t\tunderLine: Number(event.period.total.under_adjust)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: moment(),\n\t\t\t\t\t\t\t\texpireAt: moment.utc(event.period.periodcutoff_datetimeGMT).add(4, 'h').subtract(5, 'm').subtract(1, 'seconds')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst existedEventOdd = await EventOdd.findOne({ uniqueId: newEventOdd.uniqueId })\n\t\t\t\t\t\t\tif(_.isEmpty(existedEventOdd)){\n\t\t\t\t\t\t\t\tawait new EventOdd(newEventOdd).save()\n\t\t\t\t\t\t\t\tconsole.log(`saved ${newEventOdd.uniqueId}`)\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tawait EventOdd.findOneAndUpdate({ uniqueId: newEventOdd.uniqueId }, { $set: newEventOdd })\n\t\t\t\t\t\t\t\tconsole.log(`updated ${newEventOdd.uniqueId}`)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null\n\n\n\t\t \t\t\t}))\n\n\t\t \t\t}else{\n\t\t \t\t\tconsole.log('betOnline football data empty')\n\t\t \t\t}\n\n\t\t \t}\n \t\t}\n \t}catch(err){\n \t\tthrow err\n \t}\n}\n\nexport default fetch_betOnlineFootball_eventOdds"]}