{"version":3,"sources":["../../src/updateDB/E1_determine_OpenBet_eventOdds_result.js"],"names":["determine_OpenBet_eventOdds_result","find","openBets","isEmpty","Promise","all","map","openBet","eventOdds","event","status","sport","betDetail","score","betType","oddPoint","oddTarget","homeScore","awayScore","Number","resultStatus","findOneAndUpdate","orderNumber","$elemMatch","singlePickId"],"mappings":"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","file":"E1_determine_OpenBet_eventOdds_result.js","sourcesContent":["import _ from 'lodash';\nimport { OpenBet } from '../models/BetOrder';\n\n\nconst determine_OpenBet_eventOdds_result = async () => {\n\ttry{\n\n\t\tconst openBets = await OpenBet.find({})\n\t\tif(!_.isEmpty(openBets)){\n\t\t\tawait Promise.all(openBets.map(async openBet => {\n\t\t\t\tawait Promise.all(openBet.eventOdds.map(async event => {\n\t\t\t\t\tconst { status, sport, betDetail, score } = event\n\t\t\t\t\tlet { betType, oddPoint, oddTarget } = betDetail\n\t\t\t\t\tlet { homeScore, awayScore } = score\n\n\t\t\t\t\toddPoint = Number(oddPoint)\n\t\t\t\t\thomeScore = Number(homeScore)\n\t\t\t\t\tawayScore = Number(awayScore)\n\n\t\t\t\t\tlet resultStatus = status\n\t\t\t\t\tif(status === 'Finished'){\n\t\t\t\t\t\tswitch(true){\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Home'  && homeScore + oddPoint - awayScore === 0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Away'  && awayScore + oddPoint - homeScore === 0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Over'  && homeScore + awayScore - oddPoint === 0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Under' && oddPoint - homeScore + awayScore === 0.25:\n\t\t\t\t\t\t\t\tresultStatus = 'Won Half'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Home'  && homeScore + oddPoint - awayScore === -0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Away'  && awayScore + oddPoint - homeScore === -0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Over'  && homeScore + awayScore - oddPoint === -0.25:\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Under' && oddPoint - homeScore + awayScore === -0.25:\n\t\t\t\t\t\t\t\tresultStatus = 'Lost Half'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Home'  && homeScore > awayScore:\n\t\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Away'  && awayScore > homeScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) > awayScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) > homeScore:\n\t\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Over'  && ( homeScore + awayScore ) > oddPoint:\n\t\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Under' && ( homeScore + awayScore ) < oddPoint:\n\t\t\t\t\t\t\tcase betType === 'Draw'   && homeScore === awayScore:\n\t\t\t\t\t\t\t\tresultStatus = 'Won'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\t\tcase sport === 'Hockey' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Home'  && homeScore < awayScore:\n\t\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Away'  && awayScore < homeScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) < awayScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) < homeScore:\n\t\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Over'  && ( homeScore + awayScore ) < oddPoint:\n\t\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Under' && ( homeScore + awayScore ) > oddPoint:\n\t\t\t\t\t\t\tcase betType === 'Draw'   && homeScore !== awayScore:\n\t\t\t\t\t\t\t\tresultStatus = 'Lost'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase sport !== 'Soccer' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\t\tcase sport !== 'Hockey' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) === awayScore:\n\t\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) === homeScore:\n\t\t\t\t\t\t\tcase betType === 'Total'  && ( homeScore + awayScore ) === oddPoint:\n\t\t\t\t\t\t\t\tresultStatus = 'Push'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tresultStatus = 'Review'\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait OpenBet.findOneAndUpdate({ \n\t\t\t\t\t\t\torderNumber: openBet.orderNumber, \n\t\t\t\t\t\t\teventOdds: { $elemMatch: { singlePickId: event.singlePickId }}}, \n\t\t\t\t\t\t\t{ '$set': { 'eventOdds.$.status': resultStatus }})\n\t\t\t\t\t}\n\t\t\t\t\treturn null\n\t\t\t\t}))\n\t\t\t\treturn null\n\t\t\t}))\n\t\t}\n\t}catch(err){\n\t\tthrow err\n\t}\n\n}\n\nexport default determine_OpenBet_eventOdds_result"]}