{"version":3,"sources":["../../src/updateDB/E1_determine_OpenBet_eventOdds_result.js"],"names":["determine_OpenBet_eventOdds_result","find","openBets","isEmpty","next","Promise","all","map","openBet","eventOdds","event","status","sport","betDetail","betType","oddLine","oddPoint","oddTarget","score","homeScore","awayScore","resultStatus","findOneAndUpdate","orderNumber","$elemMatch","singlePickId","catch","err"],"mappings":"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","file":"E1_determine_OpenBet_eventOdds_result.js","sourcesContent":["import moment from 'moment';\nimport _ from 'lodash';\nimport { OpenBet } from '../models/BetOrder';\n\n\nconst determine_OpenBet_eventOdds_result = async () => {\n\ttry{\n\t\tconst openBets = await OpenBet.find({})\n\t\tif(_.isEmpty(openBets)) next()\n\t\tawait Promise.all(openBets.map(async openBet => {\n\t\t\tawait Promise.all(openBet.eventOdds.map(async event => {\n\t\t\t\tconst { status, sport } = event\n\t\t\t\tconst { betType, oddLine, oddPoint, oddTarget } = event.betDetail\n\t\t\t\tconst { homeScore, awayScore } = event.score\n\t\t\t\tlet resultStatus = status\n\t\t\t\tif(status === 'Finished'){\n\t\t\t\t\tswitch(true){\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Home'  && homeScore + oddPoint - awayScore === 0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Away'  && awayScore + oddPoint - homeScore === 0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Over'  && homeScore + awayScore - oddPoint === 0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Under' && oddPoint - homeScore + awayScore === 0.25:\n\t\t\t\t\t\t\tresultStatus = 'Won Half'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Home'  && homeScore + oddPoint - awayScore === -0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Spread' && oddTarget === 'Away'  && awayScore + oddPoint - homeScore === -0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Over'  && homeScore + awayScore - oddPoint === -0.25:\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'Total'  && oddTarget === 'Under' && oddPoint - homeScore + awayScore === -0.25:\n\t\t\t\t\t\t\tresultStatus = 'Lost Half'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Home'  && homeScore > awayScore:\n\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Away'  && awayScore > homeScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) > awayScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) > homeScore:\n\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Over'  && ( homeScore + awayScore ) > oddPoint:\n\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Under' && ( homeScore + awayScore ) < oddPoint:\n\t\t\t\t\t\tcase betType === 'Draw'   && homeScore === awayScore:\n\t\t\t\t\t\t\tresultStatus = 'Won'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase sport === 'Soccer' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\tcase sport === 'Hockey' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Home'  && homeScore < awayScore:\n\t\t\t\t\t\tcase betType === 'M-Line' && oddTarget === 'Away'  && awayScore < homeScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) < awayScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) < homeScore:\n\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Over'  && ( homeScore + awayScore ) < oddPoint:\n\t\t\t\t\t\tcase betType === 'Total'  && oddTarget === 'Under' && ( homeScore + awayScore ) > oddPoint:\n\t\t\t\t\t\tcase betType === 'Draw'   && homeScore !== awayScore:\n\t\t\t\t\t\t\tresultStatus = 'Lost'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase sport !== 'Soccer' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\tcase sport !== 'Hockey' && betType === 'M-Line' && homeScore === awayScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Home'  && ( homeScore + oddPoint ) === awayScore:\n\t\t\t\t\t\tcase betType === 'Spread' && oddTarget === 'Away'  && ( awayScore + oddPoint ) === homeScore:\n\t\t\t\t\t\tcase betType === 'Total'  && ( homeScore + awayScore ) === oddPoint:\n\t\t\t\t\t\t\tresultStatus = 'Push'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tresultStatus = 'Review'\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tawait OpenBet.findOneAndUpdate({ \n\t\t\t\t\t\torderNumber: openBet.orderNumber, \n\t\t\t\t\t\teventOdds: { $elemMatch: { singlePickId: event.singlePickId }}}, \n\t\t\t\t\t\t{ '$set': { 'eventOdds.$.status': resultStatus }})\n\t\t\t\t}\n\t\t\t\treturn null\n\t\t\t})).catch(err => { throw err })\n\t\t\treturn null\n\t\t})).catch(err => { throw err })\n\n\n\t}catch(err){\n\t\tthrow err\n\t}\n\n}\n\nexport default determine_OpenBet_eventOdds_result"]}