{"version":3,"sources":["../../src/updateDB/D1_sync_Result_to_openBet_eventOdds.js"],"names":["sync_Result_with_OpenBet_eventOdds","find","openBets","isEmpty","next","Promise","all","map","openBet","eventOdds","event","findOne","eventOddId","eventResult","findOneAndUpdate","orderNumber","$elemMatch","singlePickId","score","status","console","log","matchTime","format","catch","err"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;AACA;;;;;;AAEA,IAAMA;AAAA,sDAAqC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAGlB,kBAAQC,IAAR,CAAa,EAAb,CAHkB;;AAAA;AAGnCC,cAHmC;;AAIzC,UAAG,iBAAEC,OAAF,CAAUD,QAAV,CAAH,EAAwBE;AAJiB;AAAA,aAKnCC,QAAQC,GAAR,CAAYJ,SAASK,GAAT;AAAA,6DAAa,kBAAMC,OAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACxBH,QAAQC,GAAR,CAAYE,QAAQC,SAAR,CAAkBF,GAAlB;AAAA,mEAAsB,iBAAMG,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACb,iBAAOC,OAAP,CAAe,EAAE,iBAAiBD,MAAME,UAAzB,EAAf,CADa;;AAAA;AACjCC,6BADiC;;AAAA,sBAEnC,iBAAEV,OAAF,CAAUU,WAAV,CAFmC;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAGhC,kBAAQC,gBAAR,CAAyB,EAAEC,aAAaP,QAAQO,WAAvB,EAAoCN,WAAW,EAAEO,YAAY,EAAEC,cAAcP,MAAMO,YAAtB,EAAd,EAA/C,EAAzB,EACL,EAAE,QAAQ,EAAE,qBAAqBJ,YAAYK,KAAnC,EAA0C,sBAAsBL,YAAYM,MAA5E,EAAV,EADK,CAHgC;;AAAA;AAKtCC,0BAAQC,GAAR,CAAY,kCAAZ;AALsC;AAAA;;AAAA;AAOtCD,0BAAQC,GAAR,4CAAoDX,MAAME,UAA1D,SAAwE,sBAAOF,MAAMY,SAAb,EAAwBC,MAAxB,CAA+B,6BAA/B,CAAxE;;AAPsC;AAAA,mDAShC,IATgC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAtB;;AAAA;AAAA;AAAA;AAAA,gBAAZ,EAUFC,KAVE,CAUI,eAAO;AAAE,mBAAMC,GAAN;AAAW,aAVxB,CADwB;;AAAA;AAAA,8CAYvB,IAZuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAb;;AAAA;AAAA;AAAA;AAAA,UAAZ,EAaFD,KAbE,CAaI,eAAO;AAAE,aAAMC,GAAN;AAAW,OAbxB,CALmC;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAArC;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBA0BezB,kC","file":"D1_sync_Result_to_openBet_eventOdds.js","sourcesContent":["import moment from 'moment';\nimport _ from 'lodash';\n\nimport { OpenBet } from '../models/BetOrder';\nimport { Result } from '../models/EventOdd';\n\nconst sync_Result_with_OpenBet_eventOdds = async () => {\n\n\ttry{\n\t\tconst openBets = await OpenBet.find({})\n\t\tif(_.isEmpty(openBets)) next()\n\t\tawait Promise.all(openBets.map(async openBet => {\n\t\t\tawait Promise.all(openBet.eventOdds.map(async event => {\n\t\t\t\tconst eventResult = await Result.findOne({ 'eventResultId': event.eventOddId })\n\t\t\t\tif(!_.isEmpty(eventResult)){\n\t\t\t\t\tawait OpenBet.findOneAndUpdate({ orderNumber: openBet.orderNumber, eventOdds: { $elemMatch: { singlePickId: event.singlePickId }}}, \n\t\t\t\t\t\t{ '$set': { 'eventOdds.$.score': eventResult.score, 'eventOdds.$.status': eventResult.status }})\n\t\t\t\t\tconsole.log('updated openBet with final score')\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log(`result haven't save yet or start yet ${event.eventOddId} ${moment(event.matchTime).format('ddd, MMM DD, YYYY @ hh:mm A')}`)\n\t\t\t\t}\n\t\t\t\treturn null\n\t\t\t})).catch(err => { throw err })\n\t\t\treturn null\n\t\t})).catch(err => { throw err })\n\t\t\t\n\t}catch(err){\n\t\tthrow err\n\t}\n\n}\n\nexport default sync_Result_with_OpenBet_eventOdds\n"]}