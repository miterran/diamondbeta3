{"version":3,"sources":["../../src/updateDB/A2_fetch_pickMon_eventOdds.js"],"names":["fetch_pickMon_eventOdds","findOne","provider","activate","pickMonApi","get","apiLink","pickMon_UID","pickMon_Key","option","sportLeagues","join","eventFullCall","response","isEmpty","data","explicitArray","pickMonData","lines","game","isFunction","map","Promise","all","event","header","line","score","winner","isBefore","wagercutoff","subtract","format","void","team1","name","includes","newEventOdd","source","bookmaker","id","lastUpdated","last_update","sport","sporttype","matchTime","gamedate","team","home","homeROT","rotnum","away","team2","awayROT","details","odds","moneyLineHome","Number","money","moneyLineAway","pointSpreadAway","spread","points","pointSpreadHomeLine","pointSpreadAwayLine","totalNumber","total","overLine","over","underLine","under","drawLine","draw","updatedAt","checkOddPoints","pick","allZero","Object","values","every","val","pointSpreadHome","Math","abs","homePitcher","pitcher","awayPitcher","league","sportsubtype","region","perioddesc","oddType","console","log","cutOffTime","expireAt","uniqueId","replace","toUpperCase","existedEventOdd","save","isSame","findOneAndUpdate","$set"],"mappings":"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","file":"A2_fetch_pickMon_eventOdds.js","sourcesContent":["import config from '../config'\nimport Provider from '../models/Provider';\nimport { EventOdd, Result } from '../models/EventOdd';\nimport { OpenBet } from '../models/BetOrder';\nimport _ from 'lodash'\nimport moment from 'moment'\nimport axios from 'axios'\nimport xml2js from'xml2js-es6-promise'\n\nconst fetch_pickMon_eventOdds = async () => {\n \ttry{\n \t\tconst pickMonApi = await Provider.findOne({ provider: 'pickMon', activate: true })\n\n \t\tif(pickMonApi){\n\t\t \tconst response = await axios.get(`${pickMonApi.apiLink}uid=${config.pickMon_UID}&key=${config.pickMon_Key}&sports=${pickMonApi.option.sportLeagues.join(',')}&graded=0&full_call=${pickMonApi.option.eventFullCall}`)\n\t\t \tif(!_.isEmpty(response.data)){\n\t\t \t\tconst pickMonData = await xml2js(response.data, {explicitArray: false})\n\t\t\t \tif(!_.isEmpty(pickMonData.lines) && !_.isEmpty(pickMonData.lines.game) && _.isFunction(pickMonData.lines.game.map)){\n\t\t\t\t\tawait Promise.all(pickMonData.lines.game.map(async event => {\n\t\t\t\t \t\tif( event.header && !event.line.score.winner && moment().isBefore(moment(event.line.wagercutoff).subtract(1, 'h').format()) && event.void === '0' && !event.team1.name.includes('/')){\n\n\t\t\t\t\t\t\tlet newEventOdd = {\n\t\t\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\t\t\tprovider: `pickMon`,\n\t\t\t\t\t\t\t\t\tbookmaker: `default`,\n\t\t\t\t\t\t\t\t\tid: event.id,\n\t\t\t\t\t\t\t\t\tlastUpdated: moment(event.last_update).subtract(3, 'h')\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsport: event.sporttype,\n\t\t\t\t\t\t\t\tmatchTime: moment(event.gamedate).subtract(3, 'h'),\n\t\t\t\t\t\t\t\tteam: {\n\t\t\t\t\t\t\t\t\thome: event.team1.name,\n\t\t\t\t\t\t\t\t\thomeROT: event.team1.rotnum,\n\t\t\t\t\t\t\t\t\taway: event.team2.name,\n\t\t\t\t\t\t\t\t\tawayROT: event.team2.rotnum\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdetails: event.header || '',\n\t\t\t\t\t\t\t\todds: {\n\t\t\t\t\t\t\t\t\tmoneyLineHome: Number(event.line.money.team1) || 0,\n\t\t\t\t\t\t\t\t\tmoneyLineAway: Number(event.line.money.team2) || 0,\n\t\t\t\t\t\t\t\t\tpointSpreadAway: Number(event.line.spread.points) || 0,\n\t\t\t\t\t\t\t\t\tpointSpreadHomeLine: Number(event.line.spread.team1) || 0,\n\t\t\t\t\t\t\t\t\tpointSpreadAwayLine: Number(event.line.spread.team2) || 0,\n\t\t\t\t\t\t\t\t\ttotalNumber: Number(event.line.total.points) || 0,\n\t\t\t\t\t\t\t\t\toverLine: Number(event.line.total.over) || 0,\n\t\t\t\t\t\t\t\t\tunderLine: Number(event.line.total.under) || 0,\n\t\t\t\t\t\t\t\t\tdrawLine: Number(event.line.money.draw) || 0\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdatedAt: moment(),\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst checkOddPoints = _.pick(newEventOdd.odds, [\n\t\t\t\t\t\t\t\t'moneyLineHome', \n\t\t\t\t\t\t\t\t'moneyLineAway', \n\t\t\t\t\t\t\t\t'pointSpreadHome',\n\t\t\t\t\t\t\t\t'pointSpreadAway',\n\t\t\t\t\t\t\t\t'pointSpreadHomeLine',\n\t\t\t\t\t\t\t\t'pointSpreadAwayLine',\n\t\t\t\t\t\t\t\t'totalNumber',\n\t\t\t\t\t\t\t\t'overLine',\n\t\t\t\t\t\t\t\t'underLine',\n\t\t\t\t\t\t\t\t'drawLine'])\n\n\t\t\t\t\t\t\tconst allZero = Object.values(checkOddPoints).every(val => Number(val) === 0)\n\n\t\t\t\t\t\t\tif(!allZero){\n\n\t\t\t\t\t\t\t\tif(Number(event.line.spread.points) > 0){\n\t\t\t\t\t\t\t\t\tnewEventOdd.odds.pointSpreadHome = -Number(event.line.spread.points)\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tnewEventOdd.odds.pointSpreadHome = Math.abs(Number(event.line.spread.points))\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif(event.sporttype === 'Baseball'){\n\t\t\t\t\t\t\t\t\tnewEventOdd.team.homePitcher = event.team1.pitcher || 'Action'\n\t\t\t\t\t\t\t\t\tnewEventOdd.team.awayPitcher = event.team2.pitcher || 'Action'\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif(event.sporttype !== 'Soccer'){\n\t\t\t\t\t\t\t\t\tnewEventOdd.league = event.sportsubtype\n\t\t\t\t\t\t\t\t\tnewEventOdd.region = ''\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif(event.sporttype === 'Soccer'){\n\t\t\t\t\t\t\t\t\tnewEventOdd.league = ''\n\t\t\t\t\t\t\t\t\tnewEventOdd.region = event.sportsubtype\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tswitch(event.line.perioddesc){\n\t\t\t\t\t\t\t\t\tcase 'Game':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Game';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '1st Half':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'First Half';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '2nd Half':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Second Half';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '1st Quarter':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'First Quarter';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '2nd Quarter':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Second Quarter';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '3rd Quarter':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Third Quarter';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '3rd Quarter':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Third Quarter';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '1st 5 Innings':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'First Five Innings';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '4th Quarter':\n\t\t\t\t\t\t\t\t\t\tnewEventOdd.oddType = 'Fourth Quarter';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tconsole.log('new event !!!!!!!!!!!!!!!! ' + event.line.perioddesc)\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif(newEventOdd.oddType === 'Game'){\n\t\t\t\t\t\t\t\t\tnewEventOdd.cutOffTime = moment(event.gamedate).subtract(3, 'h').subtract(1, 's')\n\t\t\t\t\t\t\t\t\tnewEventOdd.expireAt = moment(event.gamedate).subtract(3, 'h').subtract(1, 's')\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tnewEventOdd.cutOffTime = moment(event.line.wagercutoff).subtract(3, 'h').subtract(1, 's')\n\t\t\t\t\t\t\t\t\tnewEventOdd.expireAt = moment(event.line.wagercutoff).subtract(3, 'h').subtract(1, 's')\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tnewEventOdd.uniqueId = `${newEventOdd.team.homeROT}_${newEventOdd.team.awayROT}_${newEventOdd.sport.replace(/\\s/g,'').toUpperCase()}_${newEventOdd.oddType.replace(/\\s/g,'').toUpperCase()}_${moment(newEventOdd.matchTime).format('MMDDYYYY')}`\n\n\t\t\t\t\t \t\t\tconst existedEventOdd = await EventOdd.findOne({ uniqueId: newEventOdd.uniqueId })\n\t\t\t\t\t\t\t\tif(_.isEmpty(existedEventOdd)){\n\t\t\t\t\t\t\t\t\tawait new EventOdd(newEventOdd).save()\n\t\t\t\t\t\t\t\t\tconsole.log(`saved ${newEventOdd.uniqueId}`)\n\t\t\t\t\t\t\t\t}else if(!moment(existedEventOdd.source.lastUpdated).isSame(moment(newEventOdd.source.lastUpdated).format())){\n\t\t\t\t\t\t\t\t\tawait EventOdd.findOneAndUpdate({ uniqueId: newEventOdd.uniqueId }, { $set: newEventOdd })\n\t\t\t\t\t\t\t\t\tconsole.log(`updated ${newEventOdd.uniqueId}`)\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tconsole.log(`${newEventOdd.uniqueId} is up to date`)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t \t\t}\n\n\t\t\t\t\t\treturn null\n\t\t\t\t\t}))\t\t \t\t\n\t\t\t \t}else{\n\t\t \t\t\tconsole.log('pickmon has no update')\n\t\t \t\t}\n\t\t \t}\n \t\t}\n \t}catch(err){\n \t\tthrow err\n \t}\n}\n\nexport default fetch_pickMon_eventOdds"]}