{"version":3,"sources":["../../src/middleware/jwtStrategy.js"],"names":["ExtractJwt","JwtStrategy","Strategy","jwtOptions","jwtFromRequest","fromAuthHeader","secretOrKey","jwtSecret","strategy","jwt_payload","next","role","id","findOne","Types","ObjectId","user"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAGA;;;;AACA;;;;AACA;;;;AACA;;AAEA;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;AACA,IAAMA,aAAa,sBAAYA,UAA/B;AACA,IAAMC,cAAc,sBAAYC,QAAhC;;AAEA,IAAMC,aAAa;AAClBC,iBAAgBJ,WAAWK,cAAX,EADE;AAElBC,cAAc,iBAAOC;AAFH,CAAnB;;AAKA,IAAMC,WAAW,IAAIP,WAAJ,CAAgBE,UAAhB;AAAA,sDAA4B,iBAAOM,WAAP,EAAoBC,IAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAEpCC,UAFoC,GAEvBF,WAFuB,CAEpCE,IAFoC,EAE9BC,EAF8B,GAEvBH,WAFuB,CAE9BG,EAF8B;AAAA,oBAGrCD,IAHqC;AAAA,sCAItC,QAJsC;AAAA;;AAAA;AAAA;AAAA,aAKvB,iBAAOE,OAAP,CAAe,EAAE,OAAO,mBAASC,KAAT,CAAeC,QAAf,CAAwBH,EAAxB,CAAT,EAAf,EAAuD,+GAAvD,CALuB;;AAAA;AAKpCI,UALoC;;AAM1CA,aAAON,KAAK,IAAL,EAAWM,IAAX,CAAP,GAA0BN,KAAK,IAAL,EAAW,KAAX,CAA1B;AAN0C;;AAAA;AAS1CA,WAAK,IAAL,EAAW,KAAX;AAT0C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAA5B;;AAAA;AAAA;AAAA;AAAA,IAAjB;;kBAiCeF,Q","file":"jwtStrategy.js","sourcesContent":["import config from '../config';\nimport updatePlayerStatusAfterOrder from '../updateDB/utils/updatePlayerStatusAfterOrder'\n\n\nimport Player from '../models/Player';\nimport Agent from '../models/Agent';\nimport SuperAgent from '../models/SuperAgent';\nimport { OpenBet, HistoryBet } from '../models/BetOrder';\n\nimport mongoose from 'mongoose'\n\nimport moment from 'moment'\nimport passport from \"passport\";\nimport passportJWT from \"passport-jwt\";\nconst ExtractJwt = passportJWT.ExtractJwt;\nconst JwtStrategy = passportJWT.Strategy;\n\nconst jwtOptions = {\n\tjwtFromRequest: ExtractJwt.fromAuthHeader(),\n\tsecretOrKey:  config.jwtSecret\n}\n\nconst strategy = new JwtStrategy(jwtOptions, async (jwt_payload, next) => {\n\n\tconst { role, id } = jwt_payload\n\tswitch(role){\n\t\tcase 'player':\n\t\t\tconst user = await Player.findOne({ '_id': mongoose.Types.ObjectId(id) }, 'agent superAgent account.username account.passcode account.role account.activate defaultSetting currentStatus')\n\t\t\tuser ? next(null, user) : next(null, false)\n\t\t\tbreak;\t\n\t\tdefault:\n\t\t\tnext(null, false)\n\t\t\treturn\n\t}\n\n\t// switch(jwt_payload.account.role){\n\t// \tcase 'player':\n\t// \t\tPlayer.findOne({username: jwt_payload.account.username}, 'username agent superAgent passcode accountActive accountType', function(err, user){\n\t// \t\t\tuser ? next(null, user) : next(null, false)\n\t// \t\t})\n\t// \t\tbreak;\n\t// \tcase 'agent':\n\t// \t\tAgent.findOne({username: jwt_payload.username}, 'username creditBalance accountActive passcode superAgent accountType userList', function(err, agent){\n\t// \t\t\tagent ? next(null, agent) : next(null, false)\n\t// \t\t})\n\t// \t\tbreak;\n\t// \tcase 'superAgent':\n\n\t// \tdefault:\n\t// \t\tnext(null, false)\n\t// \t\treturn;\n\t// }\n\n});\n\nexport default strategy"]}